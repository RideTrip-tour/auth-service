### **План разработки `auth-service`**

---

#### **1. Цель сервиса**
Реализация безопасной аутентификации и авторизации пользователей через JWT, включая:
- Регистрацию/логин по email и паролю
- Регистрация/логин Google auth
- Регистрация/логин VK ID
- Валидацию токенов
- Ролевую модель (user, admin)
- Подготовку к OAuth (Google, Facebook)

---

#### **2. Эндпоинты (REST API)**
| Метод | Путь               | Описание                          |
|-------|--------------------|-----------------------------------|
| POST  | `/auth/register`   | Регистрация нового пользователя   |
| POST  | `/auth/login`      | Вход и получение JWT              |
| POST  | `/auth/validate`   | Валидация токена (для gateway)    |
| POST  | `/auth/refresh`    | Обновление токена                 |
| GET   | `/auth/me`         | Получение данных текущего пользователя |

---

#### **5. Алгоритм работы**
1. **Регистрация**:
   - Хеширование пароля (bcrypt)
   - Сохранение пользователя в PostgreSQL
   - Отправка подтверждающего email (опционально)

2. **Логин**:
   - Проверка пароля
   - Генерация JWT (access + refresh токены)
   - Сохранение refresh-токена в Redis

3. **Валидация токена**:
   - Проверка подписи JWT
   - Поиск в Redis (для отозванных токенов)

---

#### **6. Безопасность**
- **JWT**: HS256 с секретным ключом (env-переменная)
- **Пароли**: bcrypt + salt
- **Защита эндпоинтов**: Rate limiting (100 RPM)
- **HTTPS**: Обязательно в продакшене

---

#### **7. Конфигурация**
`.env`:
```ini
JWT_SECRET=your_random_secret
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE=15  # минут
REFRESH_TOKEN_EXPIRE=43200  # 30 дней
DATABASE_URL=postgresql+asyncpg://user:pass@db:5432/auth_db
REDIS_URL=redis://redis:6379
```

---

#### **8. Тестирование**
1. **Юнит-тесты**:
   - Проверка хеширования паролей
   - Генерация/валидация JWT

2. **Интеграционные тесты**:
   - Полный цикл регистрации → логин → доступ к `/auth/me`

---

#### **10. Интеграция с другими сервисами**
1. **Gateway**: Проверка токенов через `/auth/validate`
2. **Users-service**: Синхронизация данных пользователей

---

### **Следующие шаги**
1. Начать с реализации моделей и миграций (SQLAlchemy + Alembic)
2. Добавить эндпоинты регистрации/логина
3. Настроить JWT-генерацию

Нужно детализировать какой-то из пунктов? Или приступить к написанию кода?